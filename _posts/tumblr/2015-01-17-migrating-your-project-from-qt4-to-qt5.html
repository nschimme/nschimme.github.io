---
layout: post
title: Migrating your project from Qt4 to Qt5
date: '2015-01-17T14:30:59-08:00'
tags:
- hacking
- qt5
- cmake
- qt4
- mume
- migrate
tumblr_url: https://nils.schimmelmann.us/post/108383930522/migrating-your-project-from-qt4-to-qt5
---
<figure data-orig-height="148" data-orig-width="125"><img data-orig-height="148" data-orig-width="125" alt="image" src="https://66.media.tumblr.com/099878e86645c9e7d806fc81ce0d1ce1/tumblr_inline_nn6yfvreb31rkukje_540.jpg"/></figure><p>I worked on a hobby project called <a href="https://github.com/MUME/MMapper">MMapper</a> back in graduate school that served as my escape from the daily grind. This project is pretty much responsible for my career as an engineer due to how much fun I had hacking on it. I fondly remember how ecstatic I was combining my love for gaming, playing the role as product manager and engineer, and building something useful for my users/fellow gamers.</p><p>Unfortunately, I abandoned my project back when I started my day job and the years have not been kind to it. I had always meant to migrate the source code from Sourceforge to GitHub and also remove some technical debt by upgrading it to the latest version of Qt but something else would always get in the way. I sat down back in September and decided that enough was enough! Little did I know that it would take more than a weekend to finally get it all working&hellip;</p><!-- more --><p>I figured my first step would be to set up my Qt developer environment again. After 4 long years I downloaded and installed the Qt development libraries and CMake build system once again.I fully expected some version breakage between the major versions of Qt but was surprised to find that CMake refused to even build my project!</p><p>CMake went through some pretty radical changes between versions 2.6 and 2.8 when they tried to streamline how they built Qt packages. I wasn&rsquo;t able to find any sort of documentation on how to migrate a CMake build from Qt4 to Qt5 other than <a href="http://cmake.3232098.n2.nabble.com/Using-Qt5-with-CMake-td7586603.html">this post</a> which only hinted at which direction to go in. After going through a lot of documentation and guess work I have eventually figured out that the old commands that we used to have to manually run (like QT4_WRAP_CPP) have been done away with newer fancier modules that do these things <a href="http://doc.qt.io/qt-5/cmake-manual.html">automatically</a>. I eventually got CMake to actually start building the code (if you want to see how I accomplished this take a look at <a href="https://github.com/MUME/MMapper/commit/81088d889084671111391ad0b88b6ed2267dd5a9">this commit</a>).</p><p>I was then greeted with the expected missing function compilation errors that occur between major API versions. I followed the <a href="http://qt-project.org/wiki/Transition_from_Qt_4.x_to_Qt5">Qt 4.x to Qt5 transition wiki</a> and easily fixed these compile time errors by migrating to the newer APIs. My project finally was able to compile and run!</p><p>The next step was packaging which meant I had to work with CMake once again but this time with CPack. I had initially migrated from Qt&rsquo;s qmake system for the sole purpose of automating the creation of installers around MMapper using CPack. This worked great with Qt4 where I was able to create rpms, source tgzs, and both Windows and Mac installers with ease. Now days it&rsquo;s a pretty different story and Qt provides the <a href="http://qt-project.org/wiki/Qt-Installer-Framework">Qt Installer Framework</a> which probably is much easier to use.</p><p>My main difficulty with packaging was including the necessary dynamic libraries that are dependencies of Qt. There has been quite a bit of regression and bloat with time and the number of libraries that are now required to be packaged for Windows are well over 20MBs in size and have quadrupled in count. This lead me to try to resort to alternative solutions where I ended up trying to <a href="http://qt-project.org/wiki/How-to-build-a-static-Qt-for-Windows-MinGW">statically compile</a> my Qt5 libraries for shipment. This took me 4 months because of various bugs that held me up until Qt 5.4 was released. Instead, I eventually just stuck with dynamically linking everything and using the new windeployqt tool that was added in Qt5. Take a look at this <a href="https://github.com/MUME/MMapper/commit/af63dc43b632869bcee218d6765ededc7596a065">commit</a> to see how I used that to eventually figure out which dependencies are required for my project.</p><p>Happy hacking!</p><p><i>12/10/2015: A year after this post, I ended up migrating QGLWidget to QOpenGLWidget due to some bugs. Read about that <a href="http://nils.schimmelmann.us/2019/10/24/2015-12-10-migrating-from-qglwidget-to-qopenglwidget.html">here</a>.</i><br/></p>
